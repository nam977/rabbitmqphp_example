<!DOCTYPE html>

<html>
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <title>IT490 Logged In Page</title>
    </head>
    <body>
        <h1>Welcome to the IT490 Logged In Page</h1>

        <button id="logoutButton">Logout</button>
    </body>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const sessionId = sessionStorage.getItem("session_id");
            const authToken = sessionStorage.getItem("auth_token");

            if (!sessionId || !authToken) {
                // No valid session, redirect to login page
                window.location.href = "login.html";
            }

            fetch("testSession.php", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    type: "validate_session",
                    session_id: sessionId,
                    auth_token: authToken
                })
            })
            .then(response => response.json())
            .then(data => {
                if (!data.valid) {
                    sessionStorage.clear();
                    window.location.href = "login.html";
                    console.log("Session is in  valid.");
                }
            })
            .catch(() => {
                console.error("Error validating session:", error);
                sessionStorage.clear();
                window.location.href = "login.html";
            });
        });

        document.getElementById("logoutButton").addEventListener("click", function() {
            // Clear the session cookies
            document.cookie = "session_id=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Lax";
            document.cookie = "auth_token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Lax";

            // Redirect to the main page
            localStorage.clear();
            sessionStorage.clear();
            window.location.href = "index.html";
        });
    </script>
</html>