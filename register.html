<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8">
		<title>IT-490-001 Registration Page</title>
	</head>

	<body>
		<section class="register-section">
			<h1>Register Below</h1>

			<form id="registerForm">
				<input type="text" name="username" id="username" placeholder="username" required>
				<br>
				<input type="password" name="password" id="password" placeholder="password" required>
				<br>
				<input type="email" for="email" name="email" placeholder="email" id="email" required>
				<br>
				<input type="hidden" name="type" value="register">
				<input type="submit" value="register">
			</form>
			<p id="textResponse">awaiting response</p>
		</section>
	<script>
			// You can add JavaScript here if needed for form validation or other purposes
		document.addEventListener("DOMContentLoaded", function() {
			function HandleRegisterResponse(response){
				console.log("Raw response:", response);
				const out = document.getElementById("textResponse");
				
				if (!out) return;
				try {
					const myJsonResponse = JSON.parse(response);

					if (myJsonResponse.status === "success") {
						out.textContent = "Registration successful! Redirecting...<p>";
						window.location.href = "index.html";
					} else {
						out.textContent = "Registration failed: " + (myJsonResponse.message || "Unknown error") + "<p>";
					}					
				} catch (e) {
					console.error("JSON parse error:", e);
					out.textContent = "Error processing response.";
				}
			}

			function SendRegisterRequestJSON(registerData)
			{
				var request = new XMLHttpRequest();
				request.open("POST","testRabbitMQClient.php",true);
				request.setRequestHeader("Content-Type","application/json");
				request.onreadystatechange = function (){
				
					if (this.readyState == 4){
						console.log("Server Response:", this.responseText);
						HandleRegisterResponse(this.responseText);
					}
				};

				request.onerror = function() {
					console.error("Request error");
					document.getElementById("textResponse").innerHTML = "A network error has occurred.";
				};
				request.send(JSON.stringify(registerData));
			}

		document.getElementById("registerForm").addEventListener("submit", function(event) {
			event.preventDefault(); // Prevent the default form submission
			const regUsername = document.getElementById("username").value.trim();
			const regPassword = document.getElementById("password").value;
			const regEmail = document.getElementById("email").value.trim();
			SendRegisterRequestJSON({ type: "register", username: regUsername, password: regPassword, email: regEmail }); 
		});
	});
	</script>
	</body>
</html>
